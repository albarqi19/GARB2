#!/bin/bash

# ุฃููู ุงูุชูููุฐ ุนูุฏ ุญุฏูุซ ุฃู ุฎุทุฃ
set -e

echo "๐ ุจุฏุก ุนูููุฉ ุงููุดุฑ..."

# ุชุญุฏูุซ ุงูููุฏ ูู ุงููุณุชูุฏุน
echo "๐ฅ ุฌูุจ ุขุฎุฑ ุชุญุฏูุซุงุช ุงูููุฏ..."
git pull origin main

# ุชุซุจูุช ุชุจุนูุงุช PHP
echo "๐ฆ ุชุซุจูุช ุชุจุนูุงุช Composer..."
composer install --optimize-autoloader --no-dev

# ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "๐๏ธ ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
php artisan migrate --force

# ูุณุญ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ
echo "๐งน ูุณุญ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ..."
php artisan optimize:clear
php artisan config:cache
php artisan route:cache
php artisan view:cache

# ุฑุจุท ูุฌูุฏ ุงูุชุฎุฒูู
echo "๐ ุฑุจุท ูุฌูุฏ ุงูุชุฎุฒูู..."
php artisan storage:link

# ุชุซุจูุช ุชุจุนูุงุช NPM ูุจูุงุก ุงูุฃุตูู
echo "๐จ ุจูุงุก ุฃุตูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ..."
npm ci
npm run build

# ุฅุนุงุฏุฉ ุชุดุบูู ุตููู ุงูููุงู
echo "๐ ุฅุนุงุฏุฉ ุชุดุบูู ุนูุงู ุงูุตููู..."
php artisan queue:restart

echo "โ ุชู ุงูุงูุชูุงุก ูู ุนูููุฉ ุงููุดุฑ ุจูุฌุงุญ!"
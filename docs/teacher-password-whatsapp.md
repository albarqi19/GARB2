# نظام إرسال كلمة المرور للمعلمين عبر واتساب

## نظرة عامة

تم تطوير نظام متكامل لإرسال كلمات المرور للمعلمين الجدد عبر واتساب، بما في ذلك إرسال رسائل الترحيب مع كلمة المرور عند إنشاء حساب جديد.

## الميزات

### 1. إرسال تلقائي عند إنشاء معلم جديد
- عند إنشاء معلم جديد، سيتم إرسال رسالة ترحيب تلقائياً مع كلمة المرور
- تتضمن الرسالة: اسم المعلم، المسجد، اسم المستخدم (رقم الهوية)، وكلمة المرور

### 2. أزرار في واجهة الإدارة
- **إرسال كلمة المرور**: لإعادة إرسال كلمة المرور الحالية
- **إعادة تعيين كلمة المرور**: لتوليد كلمة مرور جديدة وإرسالها

### 3. دوال برمجية متعددة

## كيفية الاستخدام

### 1. من واجهة الإدارة

#### إنشاء معلم جديد:
1. اذهب إلى قسم "المعلمين"
2. اضغط على "إضافة معلم جديد"
3. املأ البيانات المطلوبة (تأكد من إدخال رقم الهاتف)
4. احفظ البيانات
5. سيتم إرسال رسالة ترحيب تلقائياً مع كلمة المرور

#### إعادة إرسال كلمة المرور:
1. اذهب إلى قائمة المعلمين
2. ابحث عن المعلم المطلوب
3. اضغط على زر "إرسال كلمة المرور"
4. أكد الإرسال

#### إعادة تعيين كلمة مرور جديدة:
1. اذهب إلى قائمة المعلمين
2. ابحث عن المعلم المطلوب
3. اضغط على زر "إعادة تعيين كلمة المرور"
4. أكد العملية

### 2. من الكود البرمجي

#### إرسال رسالة ترحيب مع كلمة المرور:
```php
use App\Models\Teacher;

$teacher = Teacher::find(1);
$sent = $teacher->sendWelcomeWithPassword();
```

#### إعادة إرسال كلمة المرور الحالية:
```php
$teacher = Teacher::find(1);
$sent = $teacher->resendPassword();
```

#### إرسال كلمة مرور مخصصة:
```php
$teacher = Teacher::find(1);
$customPassword = '123456';
$sent = $teacher->sendPasswordViaWhatsApp($customPassword);
```

#### إعادة تعيين كلمة مرور جديدة:
```php
$teacher = Teacher::find(1);

// توليد كلمة مرور جديدة
$newPassword = Teacher::generateRandomPassword();

// تحديث في قاعدة البيانات
$teacher->password = $newPassword;
$teacher->must_change_password = true;
$teacher->save();

// إرسال عبر واتساب
$sent = $teacher->sendPasswordViaWhatsApp($newPassword);
```

#### استخدام WhatsAppHelper مباشرة:
```php
use App\Helpers\WhatsAppHelper;
use App\Models\Teacher;

$teacher = Teacher::find(1);

// إرسال رسالة ترحيب مع كلمة المرور
WhatsAppHelper::sendTeacherWelcomeWithPassword($teacher);

// إرسال رسالة مخصصة مع كلمة مرور
$customMessage = "مرحباً {$teacher->name}, كلمة المرور الجديدة: {$password}";
WhatsAppHelper::sendCustomPasswordMessage($teacher, '123456', $customMessage);
```

## محتوى رسالة الترحيب

تحتوي رسالة الترحيب على:

```
مرحباً الأستاذ [اسم المعلم] 📚

تم إضافتك بنجاح في نظام مركز القرآن الكريم
المسجد: [اسم المسجد]

📱 بيانات تسجيل الدخول:
اسم المستخدم: [رقم الهوية]
كلمة المرور: [كلمة المرور]

⚠️ احرص على حفظ كلمة المرور في مكان آمن
يمكنك تغيير كلمة المرور بعد تسجيل الدخول

بارك الله فيك وجعل عملك في خدمة كتاب الله في ميزان حسناتك 🤲
```

## الشروط المطلوبة

1. **رقم الهاتف**: يجب أن يكون للمعلم رقم هاتف صحيح
2. **كلمة المرور**: يجب أن تكون كلمة المرور متوفرة في النظام
3. **خدمة واتساب**: يجب أن تكون خدمة واتساب مفعلة ومضبوطة

## ملاحظات مهمة

1. **الأمان**: كلمة المرور تُرسل مرة واحدة فقط عبر واتساب
2. **التشفير**: كلمة المرور مُشفرة في قاعدة البيانات
3. **السجلات**: جميع الرسائل المُرسلة يتم تسجيلها في قاعدة البيانات
4. **Queue**: الرسائل تُرسل عبر نظام Queue لضمان الأداء
5. **Logs**: جميع العمليات يتم تسجيلها في ملفات السجل

## استكشاف الأخطاء

### المعلم لا يستقبل الرسالة:
1. تأكد من صحة رقم الهاتف
2. تأكد من وجود كلمة المرور في النظام
3. تحقق من حالة خدمة واتساب
4. راجع ملفات السجل (logs)

### كلمة المرور غير موجودة:
1. تأكد من حفظ كلمة المرور عند إنشاء المعلم
2. تحقق من الحقل `plain_password` في قاعدة البيانات
3. استخدم وظيفة إعادة تعيين كلمة المرور

## الملفات المعدلة

1. `app/Filament/Admin/Resources/TeacherResource/Pages/CreateTeacher.php`
2. `app/Helpers/WhatsAppHelper.php`
3. `app/Models/Teacher.php`
4. `app/Filament/Admin/Resources/TeacherResource.php`
5. `app/Services/WhatsAppTemplateService.php`

## أمثلة متقدمة

راجع ملف `examples/TeacherPasswordExamples.php` لأمثلة شاملة على الاستخدام.
